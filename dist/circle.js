!function(t){function e(i){if(s[i])return s[i].exports;var r=s[i]={i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var s={};e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,s){"use strict";e.b=function(t){return(t=t.replace(/^([A-Z]+)([A-Z][a-z])/g,"$1-$2")).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},e.f=function(t){return t.replace(/(-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},e.c=function(t){if(t.match(/\[/))return t.replace(/^(.*)\[[^[]+?\]$/,"$1")},e.a=function(t){return t.match(/\[/)?t.replace(/^.*\['([^']+)'\]$/,"$1"):t},e.e=function(){return null!==navigator.userAgent.match(/Firefox/)},e.d=function(){return null!==navigator.userAgent.match(/Edge/)}},function(t,e,s){"use strict";function i(t){return t.replace(/\.([^.]+)/g,"['$1']")}class r{static isTwoWays(t){return t.match(/^\[\[.*\]\]$/)}static isOneWay(t){return t.match(/^\[.*\]$/)}static isEvent(t){return t.match(/^&/)}static extractModelVar(t){let e=t.replace(/^\[(.*?)\]$/g,"$1").replace(/^\[(.*?)\]$/g,"$1");return e=i(e)}static extractEventExpr(t){return t.substring(1)}static get scope(){return{TWO_WAYS:"=",ONE_WAY:"<",LITTERAL:"@",EVENT:"&"}}}e.a=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(3);console.log("start main"),window.circle&&console.warning("circle already loaded"),window.o=function(t,e){if(void 0===e)return t.getRootNode().host;let s=t.getRootNode().host;for(;s.constructor.tag!==e;)if(!(s=s.getRootNode().host))throw new Error("circle.wc: cannot find a component with tag "+e);return s},Object.setPrototypeOf(window.o,new i.a),window.circle=window.o;class r extends o.Element{render(){let t=void 0===this.model.expr?"":this.model.expr;t="object"==typeof t?JSON.stringify(t):t,this.root.innerHTML=t}}r.reg},function(t,e,s){"use strict";var i=s(4),r=s(6);class n{constructor(){this.Element=i.a,this.Behavior=r.a,this.digestId=0,this.dependancyInjectionRegistry={},this.behaviorRegistry={}}stackTrace(){return(new Error).stack}di(t,e){return arguments.length>1&&(this.dependancyInjectionRegistry[t]=e),this.dependancyInjectionRegistry[t]}}e.a=n},function(module,__webpack_exports__,__webpack_require__){"use strict";function parseExpr(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let s=[];for(let t=e.nextNode();null!==t;t=e.nextNode())t.data.match(/{{(.*?)}}/g)&&s.push(t);s.forEach(t=>{const e=document.createElement("span");e.innerHTML=t.data.replace(/{{(.*?)}}/g,(t,e)=>`<circle-expr expr="[${e}]"></circle-expr>`);const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t)})}function parseBehavior(t){for(let e in window.circle.behaviorRegistry)t.querySelectorAll(`[${e}]`).forEach(t=>{new window.circle.behaviorRegistry[e](t)})}var __WEBPACK_IMPORTED_MODULE_0__functions_js__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__Databinding_js__=__webpack_require__(5);const doc=document.currentScript.ownerDocument;class CircleElement extends HTMLElement{static get tag(){return Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.b)(this.name)}static get reg(){window.customElements.define(this.tag,this)}static get observedAttributes(){return this._oa}static set oa(t){this._oa=t}attributeChangedCallback(t,e,s){this.setModel(Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.f)(t),s)}constructor(){function t(i){return{set(r,n,o){const c=i?`${i}['${n}']`:n;if(Array.isArray(r)&&"length"===n)return!0;r[n]=null===o||"object"!=typeof o||o instanceof s?o:new Proxy(o,t(c)),circle.digestId++,console.log("%d: %s: update %s to %s",circle.digestId,e.constructor.name,c,o,circle.stackTrace());let a=c;for(;a;)e.digest(a),a=Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.c)(a);return!0},deleteProperty:(t,s)=>(delete t[s],Array.isArray(t)&&t.length--,circle.digestId++,e.digest(i),!0),getPrototypeOf(t){return s.prototype}}}super();const e=this;class s{}this.event={},this.model=new Proxy({},t()),this.digestRegistry={},this.templateSelector="#"+this.constructor.tag,this.databinding=new __WEBPACK_IMPORTED_MODULE_1__Databinding_js__.a(this),this.isRenderingAsked=!1}getParent(){return this.getRootNode().host}connectedCallback(){this.root=this.root||this.attachShadow({mode:"open"}),this.myDoc=Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.e)()||Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.d)()||null===document.currentScript?doc:document.currentScript.ownerDocument;const t=this.myDoc.querySelector(this.templateSelector);if(t){const e=document.importNode(t.content,!0);parseExpr(e),this.root.innerHTML="",this.root.appendChild(e),parseBehavior(this.root)}this.databinding.connectedCallBack(),this.init()}init(){}askRendering(){this.isRenderingAsked||(this.isRenderingAsked=!0,setTimeout(()=>{this.render(),this.isRenderingAsked=!1},0))}render(){}onDigest(t){this.databinding.onDigest(t)}bindKey(t,e){const s=this.digestRegistry;void 0===s[t]?s[t]=[e]:s[t].push(e)}digest(t){this.digestRegistry[t]&&this.digestRegistry[t].forEach((e,s)=>{e.onDigest(t)}),this.databinding.digest(t)}getModel(absoluteKey){const k=Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.c)(absoluteKey);k&&"object"!=typeof this.getModel(k)&&this.setModel(k,{});const prefix=absoluteKey.startsWith("[")?"this.model":"this.model.",str=prefix+absoluteKey;return eval(str)}hasModel(t){const e=Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.c)(t),s=Object(__WEBPACK_IMPORTED_MODULE_0__functions_js__.a)(t);return e?this.hasModel(e)&&s in this.getModel(e):s in this.model}setModel(absoluteKey,value){if(this.getModel(absoluteKey)===value)return;const str="this.model."+absoluteKey+" = value";eval(str)}setEvent(attr,value){this.event[attr]=(()=>eval(value))}}__webpack_exports__.a=CircleElement},function(t,e,s){"use strict";var i=s(0),r=s(1);class n{constructor(t){this.elt=t,this.scope={}}initScope(){for(let t=0;t<this.elt.attributes.length;t++){const e=this.elt.attributes[t].name,s=this.elt.attributes[t].value;r.a.isTwoWays(s)?this.scope[e]=r.a.scope.TWO_WAYS:r.a.isOneWay(s)?this.scope[e]=r.a.scope.ONE_WAY:r.a.isEvent(s)?this.scope[e]=r.a.scope.EVENT:this.scope[e]=r.a.scope.LITTERAL}}getModelVar(t){return r.a.extractModelVar(this.elt.getAttribute(t))}connectedCallBack(){this.initScope();for(let t in this.scope){if(this.scope[t]===r.a.scope.LITTERAL){this.elt.setModel(Object(i.f)(t),this.elt.getAttribute(t));continue}if(this.scope[t]===r.a.scope.EVENT){this.elt.setEvent(Object(i.f)(t),r.a.extractEventExpr(this.elt.getAttribute(t)));continue}const e=this.getModelVar(t),s=this.elt.getParent();s&&s.bindKey(e,this.elt),this.elt.onDigest(e)}this.elt.askRendering()}onDigest(t){for(let e in this.scope)if(this.scope[e]!==r.a.scope.LITTERAL&&this.getModelVar(e)===t){const s=this.elt.getParent().getModel(t);this.elt.setModel(Object(i.f)(e),s)}this.elt.askRendering()}digest(t){if(t in this.scope&&(this.scope[t]===r.a.scope.LITTERAL&&this.elt.getAttribute(t)!==this.elt.getModel(Object(i.f)(t))&&this.elt.setAttribute(t,this.elt.getModel(Object(i.f)(t))),this.scope[t]===r.a.scope.TWO_WAYS)){const e=this.getModelVar(t);this.elt.getParent().setModel(e,this.elt.getModel(Object(i.f)(t)))}this.elt.askRendering()}}e.a=n},function(t,e,s){"use strict";var i=s(0),r=s(1);class n{static get tag(){return Object(i.b)(this.name)}static get reg(){window.circle.behaviorRegistry[this.tag]=this}constructor(t){this.elt=t,this.host=t.getRootNode().host,this.key=this.getModelVar(this.constructor.tag),this.init(),console.log("behavior"),this.host.bindKey(this.key,this);let e=this.key;for(;e;)this.host.bindKey(e,this),e=Object(i.c)(e);this.onDigest(this.key)}init(){}getModelVar(t){return r.a.extractModelVar(this.elt.getAttribute(t))}onDigest(){}}e.a=n}]);
//# sourceMappingURL=circle.js.map