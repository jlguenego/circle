!function(){"use strict";function t(t){return(t=t.replace(/^([A-Z]+)([A-Z][a-z])/g,"$1-$2")).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function e(t){return t.replace(/(-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})}function s(t){if(t.match(/\[/))return t.replace(/^(.*)\[[^[]+?\]$/,"$1")}function i(t){return t.match(/\[/)?t.replace(/^.*\['([^']+)'\]$/,"$1"):t}function r(t){return t.replace(/\.([^.]+)/g,"['$1']")}function n(){return null!==navigator.userAgent.match(/Firefox/)}function o(){return null!==navigator.userAgent.match(/Edge/)}function c(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let s=[];for(let t=e.nextNode();null!==t;t=e.nextNode())t.data.match(/{{(.*?)}}/g)&&s.push(t);s.forEach(t=>{const e=document.createElement("span");e.innerHTML=t.data.replace(/{{(.*?)}}/g,(t,e)=>`<circle-expr expr="[${e}]"></circle-expr>`);const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t)})}function a(t){for(let e in window.circle.behaviorRegistry)t.querySelectorAll(`[${e}]`).forEach(t=>{new window.circle.behaviorRegistry[e](t)})}window.circle&&console.warning("circle already loaded");const l=document.currentScript.ownerDocument;class h{static isTwoWays(t){return t.match(/^\[\[.*\]\]$/)}static isOneWay(t){return t.match(/^\[.*\]$/)}static isEvent(t){return t.match(/^&/)}static extractModelVar(t){let e=t.replace(/^\[(.*?)\]$/g,"$1").replace(/^\[(.*?)\]$/g,"$1");return e=r(e)}static extractEventExpr(t){return t.substring(1)}static get scope(){return{TWO_WAYS:"=",ONE_WAY:"<",LITTERAL:"@",EVENT:"&"}}}class d{constructor(t){this.elt=t,this.scope={}}initScope(){for(let t=0;t<this.elt.attributes.length;t++){const e=this.elt.attributes[t].name,s=this.elt.attributes[t].value;h.isTwoWays(s)?this.scope[e]=h.scope.TWO_WAYS:h.isOneWay(s)?this.scope[e]=h.scope.ONE_WAY:h.isEvent(s)?this.scope[e]=h.scope.EVENT:this.scope[e]=h.scope.LITTERAL}}getModelVar(t){return h.extractModelVar(this.elt.getAttribute(t))}connectedCallBack(){this.initScope();for(let t in this.scope){if(this.scope[t]===h.scope.LITTERAL){this.elt.setModel(e(t),this.elt.getAttribute(t));continue}if(this.scope[t]===h.scope.EVENT){this.elt.setEvent(e(t),h.extractEventExpr(this.elt.getAttribute(t)));continue}const s=this.getModelVar(t),i=this.elt.getParent();i&&i.bindKey(s,this.elt),this.elt.onDigest(s)}this.elt.askRendering()}onDigest(t){for(let s in this.scope)if(this.scope[s]!==h.scope.LITTERAL&&this.getModelVar(s)===t){const i=this.elt.getParent().getModel(t);this.elt.setModel(e(s),i)}this.elt.askRendering()}digest(t){if(t in this.scope&&(this.scope[t]===h.scope.LITTERAL&&this.elt.getAttribute(t)!==this.elt.getModel(e(t))&&this.elt.setAttribute(t,this.elt.getModel(e(t))),this.scope[t]===h.scope.TWO_WAYS)){const s=this.getModelVar(t);this.elt.getParent().setModel(s,this.elt.getModel(e(t)))}this.elt.askRendering()}}class g{}class u extends HTMLElement{static get tag(){return t(this.name)}static get reg(){window.customElements.define(this.tag,this)}static get observedAttributes(){return this._oa}static set oa(t){this._oa=t}attributeChangedCallback(t,s,i){this.setModel(e(t),i)}constructor(){function t(i){return{set(r,n,o){const c=i?`${i}['${n}']`:n;if(Array.isArray(r)&&"length"===n)return!0;r[n]=null===o||"object"!=typeof o||o instanceof g?o:new Proxy(o,t(c)),circle.digestId++,console.log("%d: %s: update %s to %s",circle.digestId,e.constructor.name,c,o,circle.stackTrace());let a=c;for(;a;)e.digest(a),a=s(a);return!0},deleteProperty:(t,s)=>(delete t[s],Array.isArray(t)&&t.length--,circle.digestId++,e.digest(i),!0),getPrototypeOf:function(t){return g.prototype}}}super();const e=this;this.event={},this.model=new Proxy({},t()),this.digestRegistry={},this.templateSelector="#"+this.constructor.tag,this.databinding=new d(this),this.isRenderingAsked=!1}getParent(){return this.getRootNode().host}connectedCallback(){this.root=this.root||this.attachShadow({mode:"open"}),this.myDoc=n()||o()||null===document.currentScript?l:document.currentScript.ownerDocument;const t=this.myDoc.querySelector(this.templateSelector);if(t){const e=document.importNode(t.content,!0);c(e),this.root.innerHTML="",this.root.appendChild(e),a(this.root)}this.databinding.connectedCallBack(),this.init()}init(){}askRendering(){this.isRenderingAsked||(this.isRenderingAsked=!0,setTimeout(()=>{this.render(),this.isRenderingAsked=!1},0))}render(){}onDigest(t){this.databinding.onDigest(t)}bindKey(t,e){const s=this.digestRegistry;void 0===s[t]?s[t]=[e]:s[t].push(e)}digest(t){this.digestRegistry[t]&&this.digestRegistry[t].forEach((e,s)=>{e.onDigest(t)}),this.databinding.digest(t)}getModel(t){const e=s(t);e&&"object"!=typeof this.getModel(e)&&this.setModel(e,{});const i=t.startsWith("[")?"this.model":"this.model.",r=i+t;return eval(r)}}}();
//# sourceMappingURL=circle.min.js.map
