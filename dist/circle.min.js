!function(){"use strict";function camel2Spinal(t){return(t=t.replace(/^([A-Z]+)([A-Z][a-z])/g,"$1-$2")).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function spinal2Camel(t){return t.replace(/(-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})}function dirname(t){if(t.match(/\[/))return t.replace(/^(.*)\[[^[]+?\]$/,"$1")}function basename(t){return t.match(/\[/)?t.replace(/^.*\['([^']+)'\]$/,"$1"):t}function parseAbsoluteKey(t){return t.replace(/\.([^.]+)/g,"['$1']")}function isFirefox(){return null!==navigator.t.match(/Firefox/)}function isEdge(){return null!==navigator.t.match(/Edge/)}function parseExpr(t){const i=document.i(t,NodeFilter.e,null,!1);let e=[];for(let t=i.s();null!==t;t=i.s())t.n.match(/{{(.*?)}}/g)&&e.push(t);e.forEach(t=>{const i=document.r("span");i.o=t.n.replace(/{{(.*?)}}/g,(t,i)=>`<circle-expr expr="[${i}]"></circle-expr>`);const e=t.a;e.c(i,t),e.h(t)})}function parseBehavior(t){for(let i in window.u.l)t.d(`[${i}]`).forEach(t=>{new window.u.l[i](t)})}window.u&&console.f("circle already loaded");const doc=document.g.p;class DBNotation{static m(t){return t.match(/^\[\[.*\]\]$/)}static w(t){return t.match(/^\[.*\]$/)}static y(t){return t.match(/^&/)}static C(t){let i=t.replace(/^\[(.*?)\]$/g,"$1").replace(/^\[(.*?)\]$/g,"$1");return i=parseAbsoluteKey(i)}static b(t){return t.substring(1)}static get x(){return{v:"=",B:"<",D:"@",N:"&"}}}class Databinding{constructor(t){this.$=t,this.x={}}A(){for(let t=0;t<this.$.T.length;t++){const i=this.$.T[t].name,e=this.$.T[t].K;DBNotation.m(e)?this.x[i]=DBNotation.x.v:DBNotation.w(e)?this.x[i]=DBNotation.x.B:DBNotation.y(e)?this.x[i]=DBNotation.x.N:this.x[i]=DBNotation.x.D}}k(t){return DBNotation.C(this.$.P(t))}M(){this.A();for(let t in this.x){if(this.x[t]===DBNotation.x.D){this.$.O(spinal2Camel(t),this.$.P(t));continue}if(this.x[t]===DBNotation.x.N){this.$.S(spinal2Camel(t),DBNotation.b(this.$.P(t)));continue}const i=this.k(t),e=this.$.W();e&&e.j(i,this.$),this.$.F(i)}this.$.V()}F(t){for(let i in this.x)if(this.x[i]!==DBNotation.x.D&&this.k(i)===t){const e=this.$.W().z(t);this.$.O(spinal2Camel(i),e)}this.$.V()}L(t){if(t in this.x&&(this.x[t]===DBNotation.x.D&&this.$.P(t)!==this.$.z(spinal2Camel(t))&&this.$.Z(t,this.$.z(spinal2Camel(t))),this.x[t]===DBNotation.x.v)){const i=this.k(t);this.$.W().O(i,this.$.z(spinal2Camel(t)))}this.$.V()}}class CircleProxyType{}class CircleElement extends HTMLElement{static get R(){return camel2Spinal(this.name)}static get Y(){window.H._(this.R,this)}static get I(){return this.J}static set q(t){this.J=t}G(t,i,e){this.O(spinal2Camel(t),e)}constructor(){function t(e){return{set(s,n,r){const o=e?`${e}['${n}']`:n;if(Array.isArray(s)&&"length"===n)return!0;s[n]=null===r||"object"!=typeof r||r instanceof CircleProxyType?r:new Proxy(r,t(o)),circle.Q++,console.log("%d: %s: update %s to %s",circle.Q,i.constructor.name,o,r,circle.U());let a=o;for(;a;)i.L(a),a=dirname(a);return!0},deleteProperty:(t,s)=>(delete t[s],Array.isArray(t)&&t.length--,circle.Q++,i.L(e),!0),getPrototypeOf:function(t){return CircleProxyType.prototype}}}super();const i=this;this.X={},this.tt=new Proxy({},t()),this.it={},this.et="#"+this.constructor.R,this.st=new Databinding(this),this.nt=!1}W(){return this.ot().rt}at(){this.ct=this.ct||this.ht({lt:"open"}),this.ut=isFirefox()||isEdge()||null===document.g?doc:document.g.p;const t=this.ut.dt(this.et);if(t){const i=document.ft(t.pt,!0);parseExpr(i),this.ct.o="",this.ct.gt(i),parseBehavior(this.ct)}this.st.M(),this.mt()}mt(){}V(){this.nt||(this.nt=!0,setTimeout(()=>{this.wt(),this.nt=!1},0))}wt(){}F(t){this.st.F(t)}j(t,i){const e=this.it;void 0===e[t]?e[t]=[i]:e[t].push(i)}L(t){this.it[t]&&this.it[t].forEach((i,e)=>{i.F(t)}),this.st.L(t)}z(absoluteKey){const k=dirname(absoluteKey);k&&"object"!=typeof this.z(k)&&this.O(k,{});const prefix=absoluteKey.startsWith("[")?"this.model":"this.model.",str=prefix+absoluteKey;return eval(str)}yt(t){const i=dirname(t),e=basename(t);return i?this.yt(i)&&e in this.z(i):e in this.tt}O(absoluteKey,value){if(this.z(absoluteKey)===value)return;const str="this.model."+absoluteKey+" = value";eval(str)}S(attr,value){this.X[attr]=(()=>eval(value))}}class CircleBehavior{static get R(){return camel2Spinal(this.name)}static get Y(){window.u.l[this.R]=this}constructor(t){this.$=t,this.rt=t.ot().rt,this.Ct=this.k(this.constructor.R),this.mt(),this.rt.j(this.Ct,this);let i=this.Ct;for(;i;)this.rt.j(i,this),i=dirname(i);this.F(this.Ct)}mt(){}k(t){return DBNotation.C(this.$.P(t))}F(){}}class Circle{constructor(){this.bt=CircleElement,this.xt=CircleBehavior,this.Q=0,this.vt={},this.l={}}U(){return(new Error).Bt}Dt(t,i){return arguments.length>1&&(this.vt[t]=i),this.vt[t]}}window.Et=function(t,i){if(void 0===i)return t.ot().rt;let e=t.ot().rt;for(;e.constructor.R!==i;)if(!(e=e.ot().rt))throw new Error("circle.wc: cannot find a component with tag "+i);return e},Object.setPrototypeOf(window.Et,new Circle),window.u=window.Et;class CircleExpr extends CircleElement{wt(){let t=void 0===this.tt.Nt?"":this.tt.Nt;t="object"==typeof t?JSON.stringify(t):t,this.ct.o=t}}CircleExpr.Y}();
//# sourceMappingURL=circle.min.js.map
