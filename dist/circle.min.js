!function(){"use strict";function camel2Spinal(t){return(t=t.replace(/^([A-Z]+)([A-Z][a-z])/g,"$1-$2")).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function spinal2Camel(t){return t.replace(/(-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})}function dirname(t){if(t.match(/\[/))return t.replace(/^(.*)\[[^[]+?\]$/,"$1")}function basename(t){return t.match(/\[/)?t.replace(/^.*\['([^']+)'\]$/,"$1"):t}function parseAbsoluteKey(t){return t.replace(/\.([^.]+)/g,"['$1']")}function isFirefox(){return null!==navigator.userAgent.match(/Firefox/)}function isEdge(){return null!==navigator.userAgent.match(/Edge/)}function parseExpr(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let i=[];for(let t=e.nextNode();null!==t;t=e.nextNode())t.data.match(/{{(.*?)}}/g)&&i.push(t);i.forEach(t=>{const e=document.createElement("span");e.innerHTML=t.data.replace(/{{(.*?)}}/g,(t,e)=>`<circle-expr expr="[${e}]"></circle-expr>`);const i=t.parentNode;i.insertBefore(e,t),i.removeChild(t)})}function parseBehavior(t){for(let e in window.circle.behaviorRegistry)t.querySelectorAll(`[${e}]`).forEach(t=>{new window.circle.behaviorRegistry[e](t)})}window.circle&&console.warning("circle already loaded");const doc=document.currentScript.ownerDocument;class DBNotation{static isTwoWays(t){return t.match(/^\[\[.*\]\]$/)}static isOneWay(t){return t.match(/^\[.*\]$/)}static isEvent(t){return t.match(/^&/)}static extractModelVar(t){let e=t.replace(/^\[(.*?)\]$/g,"$1").replace(/^\[(.*?)\]$/g,"$1");return e=parseAbsoluteKey(e)}static extractEventExpr(t){return t.substring(1)}static get scope(){return{TWO_WAYS:"=",ONE_WAY:"<",LITTERAL:"@",EVENT:"&"}}}class Databinding{constructor(t){this.elt=t,this.scope={}}initScope(){for(let t=0;t<this.elt.attributes.length;t++){const e=this.elt.attributes[t].name,i=this.elt.attributes[t].value;DBNotation.isTwoWays(i)?this.scope[e]=DBNotation.scope.TWO_WAYS:DBNotation.isOneWay(i)?this.scope[e]=DBNotation.scope.ONE_WAY:DBNotation.isEvent(i)?this.scope[e]=DBNotation.scope.EVENT:this.scope[e]=DBNotation.scope.LITTERAL}}getModelVar(t){return DBNotation.extractModelVar(this.elt.getAttribute(t))}connectedCallBack(){this.initScope();for(let t in this.scope){if(this.scope[t]===DBNotation.scope.LITTERAL){this.elt.setModel(spinal2Camel(t),this.elt.getAttribute(t));continue}if(this.scope[t]===DBNotation.scope.EVENT){this.elt.setEvent(spinal2Camel(t),DBNotation.extractEventExpr(this.elt.getAttribute(t)));continue}const e=this.getModelVar(t),i=this.elt.getParent();i&&i.bindKey(e,this.elt),this.elt.onDigest(e)}this.elt.askRendering()}onDigest(t){for(let e in this.scope)if(this.scope[e]!==DBNotation.scope.LITTERAL&&this.getModelVar(e)===t){const i=this.elt.getParent().getModel(t);this.elt.setModel(spinal2Camel(e),i)}this.elt.askRendering()}digest(t){if(t in this.scope&&(this.scope[t]===DBNotation.scope.LITTERAL&&this.elt.getAttribute(t)!==this.elt.getModel(spinal2Camel(t))&&this.elt.setAttribute(t,this.elt.getModel(spinal2Camel(t))),this.scope[t]===DBNotation.scope.TWO_WAYS)){const e=this.getModelVar(t);this.elt.getParent().setModel(e,this.elt.getModel(spinal2Camel(t)))}this.elt.askRendering()}}class CircleProxyType{}class CircleElement extends HTMLElement{static get tag(){return camel2Spinal(this.name)}static get reg(){window.customElements.define(this.tag,this)}static get observedAttributes(){return this._oa}static set oa(t){this._oa=t}attributeChangedCallback(t,e,i){this.setModel(spinal2Camel(t),i)}constructor(){function t(i){return{set(s,o,r){const n=i?`${i}['${o}']`:o;if(Array.isArray(s)&&"length"===o)return!0;s[o]=null===r||"object"!=typeof r||r instanceof CircleProxyType?r:new Proxy(r,t(n)),circle.digestId++;let a=n;for(;a;)e.digest(a),a=dirname(a);return!0},deleteProperty:(t,s)=>(delete t[s],Array.isArray(t)&&t.length--,circle.digestId++,e.digest(i),!0),getPrototypeOf:function(t){return CircleProxyType.prototype}}}super();const e=this;this.event={},this.model=new Proxy({},t()),this.digestRegistry={},this.templateSelector="#"+this.constructor.tag,this.databinding=new Databinding(this),this.isRenderingAsked=!1}getParent(){return this.getRootNode().host}connectedCallback(){this.root=this.root||this.attachShadow({mode:"open"}),this.myDoc=isFirefox()||isEdge()||null===document.currentScript?doc:document.currentScript.ownerDocument;const t=this.myDoc.querySelector(this.templateSelector);if(t){const e=document.importNode(t.content,!0);parseExpr(e),this.root.innerHTML="",this.root.appendChild(e),parseBehavior(this.root)}this.databinding.connectedCallBack(),this.init()}init(){}askRendering(){this.isRenderingAsked||(this.isRenderingAsked=!0,setTimeout(()=>{this.render(),this.isRenderingAsked=!1},0))}render(){}onDigest(t){this.databinding.onDigest(t)}bindKey(t,e){const i=this.digestRegistry;void 0===i[t]?i[t]=[e]:i[t].push(e)}digest(t){this.digestRegistry[t]&&this.digestRegistry[t].forEach((e,i)=>{e.onDigest(t)}),this.databinding.digest(t)}getModel(absoluteKey){const k=dirname(absoluteKey);k&&"object"!=typeof this.getModel(k)&&this.setModel(k,{});const prefix=absoluteKey.startsWith("[")?"this.model":"this.model.",str=prefix+absoluteKey;return eval(str)}hasModel(t){const e=dirname(t),i=basename(t);return e?this.hasModel(e)&&i in this.getModel(e):i in this.model}setModel(absoluteKey,value){if(this.getModel(absoluteKey)===value)return;const str="this.model."+absoluteKey+" = value";eval(str)}setEvent(attr,value){this.event[attr]=(()=>eval(value))}}class CircleBehavior{static get tag(){return camel2Spinal(this.name)}static get reg(){window.circle.behaviorRegistry[this.tag]=this}constructor(t){this.elt=t,this.host=t.getRootNode().host,this.key=this.getModelVar(this.constructor.tag),this.init(),this.host.bindKey(this.key,this);let e=this.key;for(;e;)this.host.bindKey(e,this),e=dirname(e);this.onDigest(this.key)}init(){}getModelVar(t){return DBNotation.extractModelVar(this.elt.getAttribute(t))}onDigest(){}}class Circle{constructor(){this.Element=CircleElement,this.Behavior=CircleBehavior,this.digestId=0,this.dependancyInjectionRegistry={},this.behaviorRegistry={}}stackTrace(){return(new Error).stack}di(t,e){return arguments.length>1&&(this.dependancyInjectionRegistry[t]=e),this.dependancyInjectionRegistry[t]}}window.o=function(t,e){if(void 0===e)return t.getRootNode().host;let i=t.getRootNode().host;for(;i.constructor.tag!==e;)if(!(i=i.getRootNode().host))throw new Error("circle.wc: cannot find a component with tag "+e);return i},Object.setPrototypeOf(window.o,new Circle),window.circle=window.o;class CircleExpr extends CircleElement{render(){let t=void 0===this.model.expr?"":this.model.expr;t="object"==typeof t?JSON.stringify(t):t,this.root.innerHTML=t}}CircleExpr.reg}();
//# sourceMappingURL=circle.min.js.map
